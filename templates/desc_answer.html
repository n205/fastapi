<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>価値観マッチング - 本実施</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>価値観マッチング（本実施）</h1>

  <section id="philosophy">
    <h2>サービスの思想</h2>
    <p>
      このサービスは、単なる条件マッチングではなく、価値観や働き方の深い適合性を重視しています。  
      表面的な条件だけでなく、企業が持つ思想や文化との共鳴を大切にすることで、  
      あなたが心から納得できる選択をサポートします。
    </p>
    <p><a href="/">← イメージをつかみたい場合はこちら</a></p>
  </section>

  <section id="full-matching">
    <h2>本実施版マッチング</h2>
    <form id="full-form"></form>
    <div id="result"></div>
  </section>
  
  <script>
  async function loadFullQuestions() {
    const res = await fetch('/api/questions'); // 全7問
    const data = await res.json();
    const allQuestions = data.questions;
  
    const saved = localStorage.getItem("preAnswers");
    const preAnswers = saved ? JSON.parse(saved) : {};
  
    const form = document.getElementById("full-form");
    form.innerHTML = '';
  
    allQuestions.forEach((q, i) => {
      const block = document.createElement('div');
      block.className = 'question-block';
      block.innerHTML = `
        <label>${q.text}</label>
        <div class="slider-container">
          <span class="slider-label">あまり似ていない</span>
          <input type="range" name="q${i + 1}" min="1" max="7" value="${preAnswers[`q${i + 1}`] || 4}">
          <span class="slider-label">とても似ている</span>
        </div>
      `;
      form.appendChild(block);
    });
  
    // 回答変化でランキング再計算
    form.addEventListener('input', updateRanking);
  
    // 初回表示
    updateRanking();
  }
  
  async function updateRanking() {
    const form = document.getElementById("full-form");
    const formData = new FormData(form);
  
    // 軸も送る
    const resQ = await fetch('/api/questions');
    const dataQ = await resQ.json();
    dataQ.questions.forEach((q, i) => {
      formData.append(`axis${i + 1}`, q.axis);
    });
  
    const res = await fetch('/api/rank', {
      method: 'POST',
      body: formData
    });
  
    document.getElementById("result").innerHTML = await res.text();
  }
  
  window.onload = loadFullQuestions;
  </script>
  
</body>
</html>
