<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¾¡å€¤è¦³ãƒãƒƒãƒãƒ³ã‚° - æœ¬å®Ÿæ–½</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>ä¾¡å€¤è¦³ãƒãƒƒãƒãƒ³ã‚°ï¼ˆæœ¬å®Ÿæ–½ï¼‰</h1>

  <section id="philosophy">
    <h2>ã‚µãƒ¼ãƒ“ã‚¹ã®æ€æƒ³</h2>
    <p>
      ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€å˜ãªã‚‹æ¡ä»¶ãƒãƒƒãƒãƒ³ã‚°ã§ã¯ãªãã€ä¾¡å€¤è¦³ã‚„åƒãæ–¹ã®æ·±ã„é©åˆæ€§ã‚’é‡è¦–ã—ã¦ã„ã¾ã™ã€‚  
      è¡¨é¢çš„ãªæ¡ä»¶ã ã‘ã§ãªãã€ä¼æ¥­ãŒæŒã¤æ€æƒ³ã‚„æ–‡åŒ–ã¨ã®å…±é³´ã‚’å¤§åˆ‡ã«ã™ã‚‹ã“ã¨ã§ã€  
      ã‚ãªãŸãŒå¿ƒã‹ã‚‰ç´å¾—ã§ãã‚‹é¸æŠã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
    </p>
    <p><a href="/">â† ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã¤ã‹ã¿ãŸã„å ´åˆã¯ã“ã¡ã‚‰</a></p>
  </section>

  <section id="full-matching">
    <h2>æœ¬å®Ÿæ–½ç‰ˆãƒãƒƒãƒãƒ³ã‚°</h2>
    <form id="full-form"></form>

    <div id="purchase">
      <p>å›ç­”ãŒå®Œäº†ã™ã‚‹ã¨ã€ä¾¡å€¤è¦³ãƒ¬ãƒãƒ¼ãƒˆï¼ˆPDFï¼‰ã‚’è³¼å…¥ã§ãã¾ã™ã€‚</p>
      <button type="button" id="purchase-btn">ğŸ“„ 500å††ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’è³¼å…¥ã™ã‚‹</button>
    </div>
  </section>
  
  <script>
  async function loadFullQuestions() {
    const res = await fetch('/api/questions'); // å…¨7å•
    const data = await res.json();
    const allQuestions = data.questions;

    const saved = localStorage.getItem("preAnswers");
    const preAnswers = saved ? JSON.parse(saved) : {};

    const form = document.getElementById("full-form");
    form.innerHTML = '';

    allQuestions.forEach((q, i) => {
      const block = document.createElement('div');
      block.className = 'question-block';
      block.innerHTML = `
        <label>${q.text}</label>
        <div class="slider-container">
          <span class="slider-label">ã‚ã¾ã‚Šä¼¼ã¦ã„ãªã„</span>
          <input type="range" name="q${i + 1}" min="1" max="7" value="${preAnswers[`q${i + 1}`] || 4}">
          <span class="slider-label">ã¨ã¦ã‚‚ä¼¼ã¦ã„ã‚‹</span>
        </div>
      `;
      form.appendChild(block);
    });
  }

  async function startCheckout() {
    try {
      const res = await fetch('/create-checkout-session', { method: 'POST' });
      const data = await res.json();
      if (data.url) {
        window.location.href = data.url;
      } else {
        alert('è³¼å…¥ãƒšãƒ¼ã‚¸ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (err) {
      console.error(err);
      alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  window.onload = loadFullQuestions;
  document.getElementById('purchase-btn').addEventListener('click', startCheckout);
    
  </script>
</body>
</html>
